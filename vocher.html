
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign Up</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:system-ui;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center
}
.card{
  background:#fff;
  padding:2.5rem;
  border-radius:20px;
  width:100%;
  max-width:420px;
  box-shadow:0 25px 50px rgba(0,0,0,.15)
}
h1{text-align:center;margin-bottom:2rem}
.form-group{margin-bottom:1.5rem}
label{display:block;margin-bottom:.6rem}
input{
  width:100%;
  padding:14px;
  border:2px solid #e1e5e9;
  border-radius:12px;
  font-size:16px
}
button{
  width:100%;
  padding:14px;
  background:linear-gradient(135deg,#667eea,#764ba2);
  border:none;
  border-radius:12px;
  color:#fff;
  font-size:16px;
  cursor:pointer;
  transition: opacity 0.3s;
}
button:disabled{opacity:.6}
.message{margin-top:1rem;padding:12px;border-radius:10px;text-align:center}
.success{background:#c6f6d5;color:#22543d}
.error{background:#fed7d7;color:#742a2a}
.hidden{display:none}
#downloadBtn { margin-top: 1rem; background: #2d3748; }
</style>
</head>

<body>
<div class="card">
  <h1>Create Account</h1>

  <form id="signupForm">
    <div class="form-group">
      <label>Username</label>
      <input id="username" required minlength="3">
    </div>

    <div class="form-group">
      <label>Password</label>
      <input type="password" id="password" required minlength="4">
    </div>

    <button id="submitBtn">Create Account</button>
    <div id="message"></div>
  </form>

  <button id="downloadBtn" class="hidden">
    Download Details & Continue
  </button>
</div>

<script>
/* ðŸ”´ API ENDPOINT */
const API_BASE = 'https://newpay-1.onrender.com';

const form = document.getElementById('signupForm');
const msg = document.getElementById('message');
const btn = document.getElementById('submitBtn');
const downloadBtn = document.getElementById('downloadBtn');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');

let savedUsername = '';
let savedPassword = '';

form.addEventListener('submit', async e => {
  e.preventDefault();

  savedUsername = usernameInput.value.trim();
  savedPassword = passwordInput.value;

  btn.disabled = true;
  btn.textContent = 'Creating...';
  msg.innerHTML = '';

  try {
    const res = await fetch(`${API_BASE}/api/signup`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ username:savedUsername, password:savedPassword })
    });

    const data = await res.json();

    if (!res.ok) throw new Error(data.error || 'Signup failed');

    msg.innerHTML = `<div class="message success">${data.message}</div>`;
    downloadBtn.classList.remove('hidden');
    btn.classList.add('hidden'); // Hide original button once success occurs
    form.reset();

  } catch (err) {
    console.error(err);
    msg.innerHTML = `<div class="message error">${err.message}</div>`;
    btn.disabled = false;
    btn.textContent = 'Create Account';
  }
});

downloadBtn.onclick = () => {
  // 1. Create the image file
  const c = document.createElement('canvas');
  c.width = 640; c.height = 360;
  const x = c.getContext('2d');

  x.fillStyle='#fff'; x.fillRect(0,0,640,360);
  x.fillStyle='#4f46e5'; x.font='bold 28px Arial';
  x.fillText('Your Login Details',40,60);

  x.fillStyle='#111'; x.font='22px Arial';
  x.fillText(`Username: ${savedUsername}`,40,150);
  x.fillText(`Password: ${savedPassword}`,40,210);

  // 2. Trigger download
  const a = document.createElement('a');
  a.download = `login-${Date.now()}.png`;
  a.href = c.toDataURL();
  a.click();

  // 3. Redirect to index.html after 1 second delay
  msg.innerHTML = `<div class="message success">Download started. Redirecting...</div>`;
  setTimeout(() => {
    window.location.href = 'index.html'; 
  }, 1000);
};
</script>
</body>
</html>
